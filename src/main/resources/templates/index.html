<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <title>Welcome Library Page</title>
    <div th:replace="fragments/header :: header-css"/>
</head>
<body>
<div th:replace="fragments/header :: header"/>

<div class="container">
    <h1>Welcome to Library Page</h1>
    <br>
    <br>
    <div class="starter">
            <h2>
                <div sec:authorize="hasAuthority('READER')">
                Visit <a th:href="@{/reader}">your Profile Page</a>
                </div>
            </h2>
        <div class="is librarian" sec:authorize="hasAuthority('ADMIN')">
                <h2>Visit <a th:href="@{/librarian}">Librarian Page</a></h2>
        </div>

    </div>
    <h3>List of books</h3>
    <table class="table table-bordered table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Author</th>
                <th>Published</th>
                <th>Status</th>
                <div sec:authorize="isAuthenticated()">
                    <th>Action</th>
                </div>
            </tr>
        </thead>
        <tbody>
            <tr th:each="tempBook : ${books}">
                <td th:text="${tempBook.id}"/>
                <td th:text="${tempBook.title}"/>
                <td th:text="${tempBook.author}"/>
                <td th:text="${tempBook.published}"/>
                <td>
                    <div class="bookStatus"
                         th:if="${tempBook.status} == true">
                        In hands
                    </div>
                    <div class="bookStatus"
                         th:if="${tempBook.status} == false">
                        Free
                    </div>
                </td>
                <div sec:authorize="isAuthenticated()">
                    <td>
                        <div class="canTake" sec:authorize="hasAuthority('READER')"
                             th:if="${tempBook.status} == false">
                            <a th:href="@{/reader/takeABook}"
                               class="btn btn-info btn-sm">
                                Take
                            </a>
                        </div>
                        <div class="canReturn"
                             th:if="${#authentication.getPrincipal()} == ${tempBook.reader} AND
                             ${tempBook.status} == true">
                            <a th:href="@{/reader/returnABook}"
                               class="btn btn-info btn-sm">
                                Return
                            </a>
                        </div>
                    </td>
                </div>
            </tr>
        </tbody>
    </table>

</div>
<div th:replace="fragments/footer :: footer"/>
</body>
</html>